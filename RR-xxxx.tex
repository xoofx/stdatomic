\documentclass[a4paper,preprint,10pt,natbib,authoryear,onecolumn,prodmode,acmtoplas]{acmsmall}
\newif\iflong
\longtrue
\def\itemadjust{}
\usepackage{RR-white}
\usepackage[table]{xcolor}
%\usepackage{natbib}
%\usepackage[chapter]{smartref}
\newcommand{\smartref}[1]{\ref{#1}}
\usepackage{chngcntr}
\usepackage{MnSymbol}
\usepackage{bbding}
%\counterwithout{section}{chapter}
\usepackage[hyperindex]{hyperref}
\hypersetup{
    pdftitle={Futex based locks for C11's generic atomics},
    pdfauthor={Jens Gustedt},
    pdfkeywords={lock primitives, atomics, C11, futex, Linux},
    pdfsubject={Futex based locks for C11's generic atomics},
    bookmarksopen = true,
    pdflang={English},
}
\usepackage{amsmath}
\usepackage[normalem]{ulem}
\usepackage{environ}
%\usepackage[T1]{fontenc}
%\usepackage{tipa}
%\usepackage{ucs}
%\SetUnicodeOption{tipa}
%\SetUnicodeOption{autogenerated}
\usepackage[euler]{textgreek}
\usepackage[utf8x]{inputenc}
\usepackage[greek,english,american]{babel}
%\usepackage{eurosym}
\usepackage{xspace, graphicx, subfigure, figlatex, array, multirow}
%\usepackage{amssymb}
\usepackage{url}
\usepackage{enumitem}
\usepackage[all,cmtip]{xy}
\usepackage{texgraphicx}% Pour inclure les pstex_t
\graphicspath{{./fig/}}
\usepackage{stfloats}
\usepackage{framed}
\usepackage{footmisc}
\definecolor{light-gray}{gray}{0.97}
%\usepackage{showlabels}
\usepackage{rotating}
\usepackage{fancybox}
\usepackage{etextools}
\usepackage{etoolbox}
\usepackage{placeins}
\setcounter{tocdepth}{2}

%\includeonly{cognition}
%\includeonly{}

% program listings
\usepackage{listings}
\usepackage{lstmisc}
\usepackage{titletoc}
\contentsuse{lstlisting}{lol}
\titlecontents{lstlisting}[2em]
              {\addvspace{0.25pc}}
              {\textbf{\lstlistingname~\thecontentslabel:} }
              {}
              {\titlerule*[0.5em]{$\cdot$}\contentspage}
              []
\usepackage{listings}
\usepackage{listings-C}
\usepackage{listings-x86_64}
\usepackage{listings-modernC}
\lstloadlanguages{C11,C99}
\lstset{
language=[errnoPOSIX]{C},
language=[tgmath]{C},
language=[threads]{C},
language=[stdatomic]{C},
language=[boundschecking]{C},
language=[99]{C},
language={C11},
style=modernC,
basicstyle=\tt\small,
moreemph=[5]{
futex_wait,
futex_wake,
smpl, ftx,
},
}

\AtBeginDocument{\setlength{\tempdimen}{\textwidth}}
\lstloadlanguages{C11,C99}
\lstset{
  language=[errnoPOSIX]{C},
  language=[tgmath]{C},
  language=[threads]{C},
  language=[stdatomic]{C},
  language=[boundschecking]{C},
  language=[99]{C},
  language={C11},
  style=modernC,
  %basicstyle=\tt\footnotesize,
  moreemph=[5]{
    CMOD,
    alias,
    complete,
    declaration,
    defexp,
    definition,
    fill,
    slot,
    import,
    init,
    entry,
    link,
    mimic,
    module,
    none,
    separator,
    snippet,
  },
}
\makeatletter
\DeclareRobustCommand*{\escapeus}[1]{%
  \begingroup\@activeus\scantokens{#1\endinput}\endgroup}
\begingroup\lccode`\~=`\_\relax
   \lowercase{\endgroup\def\@activeus{\catcode`\_=\active \let~\_}}
\makeatother
\newcommand{\code}[1]{\text{\lstinline`#1`\xspace}}
\newcommand{\aode}[1]{\text{\lstinline[language={[x86_64]Assembler}]{#1}\xspace}}
\def\basename#1{%
  \csname filename@parse\endcsname{#1}%
  \csname filename@base\endcsname.\csname filename@ext\endcsname%
}
\newcommand{\lstpartial}[4][]{%
  \par%\vspace*{-3ex}%\noindent\vbox{%
    \lstinputlisting[%
    nolol,%
    firstline=#2,%
    firstnumber=#2,%
    lastline=#3,%
    title={\hbox to \linewidth{\footnotesize\hfill\fcolorbox{gray}{light-gray}{\escapeus{\basename{#4}}}}},%
    belowcaptionskip={0.8ex},%
    abovecaptionskip={-.5ex},%
    #1%
    ]%
    {#4}%
  }%}
\newcommand{\lstextract}[4][]{%
  %\marginpar{#4}
  \par{%
    \def\label##1{}%
    \lstinputlisting[%
    nolol,%
    firstline=#2,%
    firstnumber=#2,%
    lastline=#3,%
    title={\hbox to \linewidth{\footnotesize\hfill\fcolorbox{gray}{light-gray}{\escapeus{\basename{#4}}}}},%
    belowcaptionskip={0.8ex},%
    abovecaptionskip={-.5ex},%
    #1%
    ]%
    {#4}%
  }}
\newcommand{\lstget}[4][]{%
  %\marginpar{#4}
  \par{%
    \def\label##1{}%
    \lstinputlisting[%
    nolol,%
    firstline=#2,%
    firstnumber=#2,%
    lastline=#3,%
    caption={},%
    backgroundcolor={},%
    #1%
    ]%
    {#4}%
  }}
\newcommand{\lstassembler}[4][]{%
  \par%
    \lstinputlisting[%
    language={[x86_64]Assembler},%
    nolol,%
    firstline=#2,%
    firstnumber=#2,%
    lastline=#3,%
    title={\hbox to \linewidth{\footnotesize\hfill\fcolorbox{gray}{light-gray}{\escapeus{\basename{#4}}}}},%
    belowcaptionskip={0.8ex},%
    abovecaptionskip={-.5ex},%
    #1%
    ]%
    {#4}%
  }
\def\textexclam{!}
% program output
\usepackage{fancyvrb}
\renewcommand{\FancyVerbFormatLine}[1]{%
  \colorbox{light-gray}{\hbox to 0.95\linewidth{#1\hfill}}%
}
\DefineVerbatimEnvironment%
{TerminalX}{Verbatim}
{
%commandchars=\\\{\},
firstnumber=0,
samepage=true,
fontsize=\footnotesize,
numbers=left,
numbersep=2mm,
label=\raisebox{0.6ex}[2ex][0ex]{\fcolorbox{black}{light-gray}{\small Terminal}},
frame=single,
fillcolor=\color{light-gray},
framesep=1em
}
\newenvironment{terminal}
  {\VerbatimEnvironment
   \vspace*{1ex}
   \TerminalX}
  {\endTerminalX}


\usepackage{fmtcount}
% \def\hechs#1{
%   %\def\ARG{\arabic{#1}}%
%   \ifthenelse{#1<10}{\arabic{#1}}{\alph{#1}}
%   %\alph{#1}
% }
% \renewcommand{\thesection}{\hexadecimal{section}}
% \renewcommand{\thesubsection}{\thesection.\hexadecimal{subsection}}
% \renewcommand{\thesubsubsection}{\thesubsection.\hexadecimal{subsubsection}}

%\newcommand{\shortchaptername}{Lev.}
% indexing
\newcommand{\specindex}[2][]{%
  \expandafter\newcommand\csname#2index\endcsname[2][]{%
    \def\CAT{#1}%
    \ifx\CAT\empty%
    \else%
    \def\CAT{|#1}%
    \fi%
    \def\ARG{##1}%
    \ifx\ARG\empty%
    \index{##2\CAT}%
    \else%
    \index{##1\CAT}%
    \fi%
    \csname#2\endcsname{##2}\noexpand\xspace%
  }%
}
\specindex[textbf]{emph}
\newcommand{\jargon}[1]{{\bf\em #1}$^{C}$}
\specindex{jargon}
\newcommand{\plain}[1]{#1}
\specindex{plain}

\def\footwarmmark{[Exs~\arabic{footnote}]}
%\newtheorem{exs}{Exercise}
\makeatletter
\def\blfootnote{\xdef\@thefnmark{\footwarmmark}\@footnotetext}
\makeatother
\newcommand{\footwarm}[2][]{%
  \def\ARG{#1}%
  \ifx\ARG\empty%
  \else%
  \def\ARG{\label{#1}}%
  \fi%
  \addtocounter{footnote}{1}%
  ${}^{\text{\footwarmmark}}$\blfootnote{\ARG\ #2}%
}

\newcommand{\STDC}[3][]{
  \def\ARG{#1}%
  \ifx\ARG\empty%
  \def\ARG{9899:2011}%
  \fi%
  \def\PAR{#3}%
  \ifx\PAR\empty%
  \else
  \def\PAR{~#3}%
  \fi%
  ISO~\ARG~#2\PAR\xspace
}
% \newtheoremstyle{common}
%     {0ex}% above space
%     {0ex}% below space
%     {\itshape}% body font
%     {0em}% indent
%     {\begin{tabular}{l}\cellcolor{yellow}}% head font
%     {\end{tabular}}% punct after head
%     {.5em}% space
%     {}% custom
% \theoremstyle{common}
\newtheorem{remInder}{Rule}%[subsection]
\gdef\Arg{}%
\newcommand{\Reminder}[2][]{%
  \begin{remInder}%[#1]%
  \begin{minipage}[t]{0.8\linewidth}%
    #2%
  \end{minipage}%
  \end{remInder}%
  \def\Arg{#1}%
  \ifx\Arg\empty\let\Arg=\relax\else\def\Arg{\noexpand\noexpand\noexpand\marginpar{#1}}\fi%
  \addcontentsline{rem}{section}{\colorbox{yellow}{\hbox to
      3.5em{\theremInder}}\ #2\Arg}%
}
\NewEnviron{reminder}[1][]{%
  \removelastskip%
  \vskip 0.5ex plus 0.5ex minus 0.5ex%
    \Reminder[#1]{%
      \BODY%
    }%
  \vskip 0.5ex plus 0.5ex minus 0.5ex%
  %\ \hfill\\
}
\newcommand{\remindername}{Reminders}
\newcommand{\listofreminders}{
  \clearpage
  %\addcontentsline{toc}{chapter}{\remindername}
  \csname @starttoc\endcsname{rem}\remindername
}

\newcommand{\Cinclude}[1]{\texttt{#1}}

\newenvironment{annexpar}[1]{
  \pagebreak[2]
  \noindent\index{Annex #1}
  \ \marginpar{\mbox{\footnotesize Annex~#1}}\pagebreak[0]\\[-2ex]%
  \pagebreak[0]\noindent
  \definecolor{shadecolor}{named}{lightgray}
  \begin{shaded}
}{\end{shaded}}

\newenvironment{AnnexK}{\begin{annexpar}{K}}{\end{annexpar}}

\newenvironment{DoxyItemize}{\itemize}{\enditemize}
\newenvironment{DoxySeeAlso}[1]{\par\smallskip\textbf{#1}: }{\par}
\newenvironment{DoxyParams}[1]{\par\smallskip\textbf{#1}:\hfill%
  \tabular[t]{|l|p{8.5cm}|}\hline%
}
{\endtabular\par\bigskip}
\newenvironment{DoxyRemark}[1]{\par\smallskip\textbf{#1}: }{\par}
\newenvironment{DoxyReturn}[1]{\par\smallskip\textbf{#1}: }{\par}
\newcommand{\longPar}{\let\oPar=\par\def\par{\oPar\medskip\let\par=\oPar}}
\newenvironment{DoxyDocu}[1]{%
  \index{#1@\texttt{#1}}%
  \parindent=0pt%
  \longPar%
  \code{#1}: %
  \parskip=1ex%
}{}
\newcommand{\functionDocu}[4]{
  \def\FName{\escapeus{\basename{#4}}}%
  \par\medskip\noindent%
  \fcolorbox{gray}{light-gray}{
    \begin{minipage}[t]{0.97\linewidth}
      \hfill{\tiny \texttt{\FName}}\\%
      \input{code/snippets/#1}
      \par
      \lstinputlisting[%
      numbers=none,%
      frame=topline,%
      firstline=#2,%
      firstnumber=#2,%
      lastline=#3,%
      ]{#4}
    \end{minipage}
  }
  \medskip
}

%\newtheorem{definition}{Definition}
%\newtheorem{theorem}{Theorem}
%\newtheorem{lemma}{Lemma}
%\newtheorem{corollary}{Corollary}
% \conferenceinfo{CONF 'yy}{Month d--d, 20yy, City, ST, Country}
% \copyrightyear{2015}
% \copyrightdata{978-1-nnnn-nnnn-n/yy/mm}
% \doi{nnnnnnn.nnnnnnn}

\newcommand{\Prepro}{\ensuremath{\mathcal{P}}}
\newcommand{\Header}{\ensuremath{\mathcal{H}}}
\newcommand{\Decl}{\ensuremath{\mathcal{D}}}
\newcommand{\Impl}{\ensuremath{\mathcal{I}}}
\newcommand{\spare}{\mbox{\tiny\Plus}}


\makeatletter
\makeatother


\RRprojet{Camus}
\RCNancy
\RRdate{November 2015}

\begin{document}
%\terms{Languages; Standardization;}
%\acmVolume{subm.}
%\acmNumber{N}
%\acmArticle{\spare}
%\acmYear{2015}
%\acmMonth{6}
%\acmformat{Jens Gustedt. 2015. Modular C.}
%\markboth{Jens Gustedt}{Modular C}
%\maketitle

\RRNo{XXXX}
\RRetitle {Futex based locks for C11's generic atomics}
\RRauthor {Jens Gustedt%
\thanks[inria]{Inria, France}%
\thanks[uniS]{Universit\'{e} de Strasbourg, ICube, France}%
}
\RRtitle  {}
\titlehead{Futex based locks for C11's generic atomics}

% {jens gustedt inria fr}
%\urladdr{\url{http://icube-icps.unistra.fr/index.php/Jens\_Gustedt}}
%\preprintfooter{all rights reserved}   % 'preprint' option specified.
% \authorinfo{Geminus Caecus}
% {terra incongnita}
% {}
%\thanks{blabla ICube, Strasbourg, France}
% \keywords{}

\RRabstract {
\input{C11-futex-abstract}
}

\RRkeyword {lock primitives, atomics, C11, futex, Linux}

\RRresume{%
%\input{C11-futex-abstract-french}
}

\RRmotcle {}


\makeRR

\input{C11-futex-full}


%    Bibliography styles amsplain or harvard are also acceptable.
%\nocite{*}
\bibliographystyle{ACM-Reference-Format-Journals}
\bibliography{modernC}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% mode: reftex
%%% fill-column: 75
%%% ispell-dictionary: "american"
%%% x-symbol-8bits: nil
%%% End:
